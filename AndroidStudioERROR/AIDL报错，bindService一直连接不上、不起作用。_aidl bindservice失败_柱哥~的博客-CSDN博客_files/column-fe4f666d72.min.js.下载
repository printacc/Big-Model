$(function(){function e(){var e=setInterval(function(){if(document.getElementById("csdn-toolbar")){clearInterval(e),d=document.getElementById("csdn-toolbar").offsetHeight;var o=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;o-l>0&&o<a-n&&n>0?t.css({position:"fixed","z-index":"999",left:c+"px",top:d,width:s}):t.css({position:"unset","z-index":"10",left:"0px",top:"0",width:s})}},100)}var o=window.location.href;if(o.indexOf("category_")>-1){var t=$("#column .column_info_box"),a=$("#column .column_article_list").height(),n=$("#column .column_article_list li").length?$("#column .column_article_list li").height():0,i=document.getElementsByTagName("main")[0],c=i.offsetLeft,s=i.offsetWidth,l=document.getElementsByTagName("header")[0].offsetHeight,d=0;e(),$(window).scroll(function(){e()}),$(window).resize(function(){c=i.offsetLeft,s=i.offsetWidth,e()})}}),$(function(){function e(){D="https://csdnimg.cn/release/download/images/pay_error.png",S="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+D+'"><span>'+S+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+D+'"><span class="text">'+S+"</span>")}function o(o){var c={goods_id:o,product_id:o,flag:17,request_type:4,is_use_balance:k,coupon_key:B,sale_source:U,success_function:t,error_function:n,timeout_function:i,get_pay_success_callback:a,payment_function:e};$("#payCode").html(P),$("#payCodeImg").html(F),cart.qrPay(c)}function t(e,o){j?d("payCode",o.pay_url):d("payCodeImg",o.pay_url),T=o.pay_url}function a(){E.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),E.payCode.fadeOut(function(){window.location.reload()})})}function n(e){showToast({text:e.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function i(){j?E.payCode.find("#payCode").html(H):E.getPay.find("#payCodeImg").html(L)}function c(e,o){var t=Number(e)-Number(o);return t>0?t.toFixed(2):t<0?t.toFixed(2):t}function s(e){$.ajax({type:"GET",url:"https://mall.csdn.net/mp/mallorder/api/internal/goods/getGoodsInfo?goods_id="+e+"&product_id="+e+"&flag=17",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){I=t.data.available_amount,t.data.coupon_discount&&t.data.coupon_key&&(O=1*t.data.coupon_discount,B=t.data.coupon_key),R++,R<=1&&(0==I?(k=0,$(".pay-code-radio").prop("disabled",!0)):c(G,O)>0?(k=1,$(".pay-code-radio").attr("data-flag","true"),$(".pay-code-radio").prop("checked",!0)):(k=0,$(".pay-code-radio").prop("disabled",!0))),$(".pay-balance .balance").text(I),$(".pay-code-balance .balance").text(I),l(),o(e)}})}function l(){$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"block"}),O?(c(G,O)>0?k?(c(c(G,O),I)>0?($(".available-balance-0").text("¥"+I),$(".available-balance-1").text("¥"+c(c(G,O),I))):($(".available-balance-0").text("¥"+c(G,O)),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥"+c(G,O)),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥0"),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})),$(".coupons-box .coupons-money").html("¥"+O),$(".coupons-box").fadeIn()):k?(c(G,I)>0?($(".available-balance-0").text("¥"+I),$(".available-balance-1").text("¥"+c(G,I))):($(".available-balance-0").text("¥"+G),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".now-price").text("¥"+G),$(".subscribe-available-balance").css({display:"none"}),$(".subscribe-price-box").css({display:"block"}))}function d(e,o){var t=qrcode(6,"M");t.addData(o),t.make(),$("#"+e).html(t.createImgTag(3,3)),$("#"+e).html($("#"+e).html()),j&&E.boxshadow.fadeIn(function(){E.payCode.fadeIn()})}function r(e){var o=+new Date,t=+new Date(e);times=(t-o)/1e3;var a=parseInt(times/60/60%24);a=a<10?"0"+a:a;var n=parseInt(times/60%60);n=n<10?"0"+n:n;var i=parseInt(times%60);i=i<10?"0"+i:i,$(".time-hour").text(a),$(".time-minite").text(n),$(".time-second").text(i)}function u(){$(".directory-boxshadow-dialog").hide(),setCookieBaseHour("vip_limited_time_num",(new Date).getTime(),24)}function p(e){if("popup"==e)window.csdn&&window.csdn.userOrderTip&&window.csdn.userOrderTip.show({tabs:["superVipForPopup"]});else{var o=document.createElement("a");o.style.display="none",o.href="https://mall.csdn.net/vip?vipSource=learningVip",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}function m(){var e=$(this),o=e.data("id");if(e.data("type"))var t=blogUrl+"phoenix/web/v1/subscribe/un-subscribe-study?columnId="+o;else var t=blogUrl+"phoenix/web/v1/subscribe/subscribe-study?columnId="+o;getCookie("UserName")?$.ajax({url:t,type:"post",dataType:"json",xhrFields:{withCredentials:!0},success:function(o){200==o.code&&o.data.status?e.data("type")?z.indexOf("/article/details/")>-1?window.location.reload():($(".studyvip-unsubscribe").css("display","inline-block"),$(".studyvip-subscribe").css("display","none")):z.indexOf("/article/details/")>-1?window.location.reload():($(".studyvip-subscribe").css("display","inline-block"),$(".studyvip-unsubscribe").css("display","none")):showToast({text:o.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}}):window.csdn.loginBox.show()}function b(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(o);return null!=t?unescape(t[2]):""}function f(e){window.csdn&&window.csdn.userOrderPayment&&window.csdn.userOrderPayment.show({params:[{flag:17,goodsId:e,productId:e}]})}function h(e,o){if(e.show){var t='<div class="column_coupon_main '+(e.receive?"active":"")+'">                <img class="column_coupon_icon" src="'+e.activityIcon+'" alt="">                <div class="column_coupon_text">                <span class="column_coupon_l">'+e.couponDesc+'</span>                <span class="column_coupon_m"></span>                <span class="column_coupon_r" data-couponId="'+e.groupNumber+'" data-columnId="'+o+'">'+(e.receive?"已领取":"立即领取")+"</span>                </div>            </div>";E.columnCouponBox.html(t),E.columnCouponBox.css({display:"flex"})}}function g(e,o,t){$.ajax({type:"GET",url:blogUrl+e,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:t},success:function(e){200==e.code?h(e.data,t):o.remove()},error:function(e){o.remove()}})}function y(e,o,t){$.ajax({type:"GET",url:blogUrl+e,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:t},success:function(a){200==a.code?a.data?(o.find(".column_coupon_main").addClass("active"),o.find(".column_coupon_r").html("已领取"),j?f(t):s(t)):setTimeout(function(){y(e,o,t)},500):showToast({text:a.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}function x(e,o,t){$.ajax({url:blogUrl+e,type:"post",dataType:"json",data:{columnId:t,groupNumber:o},xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data?y(E.columnCouponStatus,E.columnCouponBox,t):showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}function v(e){J.clear(),J.makeCode(e)}function w(e,o){var t={fromshare:"column"==q?"blogcolumn":"blogdetail"};e&&o&&(t={fromshare:"column"==q?"blogcolumn":"blogdetail",sharetype:e,shareId:o}),$.ajax({url:blogUrl+"phoenix/web/v1/share/get-tiny-uri",type:"GET",xhrFields:{withCredentials:!0},data:{type:q,username:username,id:"column"==q?SharecolumnId:articleId,ext:JSON.stringify(t)},success:function(e){200==e.code&&(Q=e.data.url,v(e.data.url),M=!0,setTimeout(function(){$("#tool-QRcode").show()},100))}})}function C(e){var o=document.createElement("input");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("Copy"),o.remove()}function _(e){for(var o=[];o.length<e;){var t=Math.floor(Math.random()*e);o.indexOf(t)==-1&&o.push(t)}return o}var k=0,I=0,T="",B="",O=0,U="";$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var N="",E={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay"),columnCouponBox:$("#columnCouponBox"),columnCouponCheck:"phoenix/web/v1/coupon/check-column-coupon",columnCouponStatus:"phoenix/web/v1/coupon/get-column-coupon-status",columnCouponLook:"phoenix/web/v1/coupon/get-column-coupon"},j=!1,z=window.location.href;z.indexOf("category_")>-1&&(E.columnCouponBox.length&&(N=E.columnCouponBox.data("id"),g(E.columnCouponCheck,E.columnCouponBox,N)),E.getPay.length&&(j=!1,N=E.getPay.data("id"),getCookie("UserName")&&(U=b("sale_source"),s(N)))),z.indexOf("/article/details/")>-1&&E.columnCouponBox.length&&(j=!0,N=E.columnCouponBox.data("id"),g(E.columnCouponCheck,E.columnCouponBox,N)),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),E.getPay.on("click",function(){j=!1,N=$(this).data("id"),o(N)}),E.payCode.on("click",".renovate",function(){o(N||$(this).parent().data("id"))}),E.btClose.on("click",function(){E.payCode.fadeOut(function(){E.boxshadow.fadeOut()})});var D=blogStaticHost+"dist/pc/img/pay-time-out.png",S="获取中",F='<img class="repeat-again" src="'+D+'"><span class="text">'+S+"</span>",P='<div class="renov-men"><img src="'+D+'"><span>'+S+"</span></div>",H='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',L='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var e=$(this).attr("data-flag");"true"==e?(k=0,$(this).attr("data-flag","false"),$(this).prop("checked",!1)):(k=1,$(this).attr("data-flag","true"),$(this).prop("checked",!0)),s(N)});var G=$(".subscribe-price .now-price").text().slice(1),R=0;E.payCode.on("click",".blance-bt",function(){window.open(T)}),$(document).on("click",".articleColumnBt",function(){if(getCookie("UserName")){var e=$(this).data("id");f(e)}else window.csdn.loginBox.show({spm:"1001.2101.3001.8610"})}),$(document).on("click",".ordertip_header_btn",function(){getCookie("vip_limited_time_num")||$.ajax({type:"GET",url:blogUrl+"phoenix/web/v1/coupon/get-vip-coupon-info",dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(200==e.code&&e.data&&e.data.canShow){$(".directory-boxshadow-dialog").show(),setCookieBaseHour("vip_limited_time_num",(new Date).getTime(),24),window.csdn.report&&"function"==typeof window.csdn.report.reportView&&window.csdn.report.reportView({spm:"1001.2101.3001.9621"}),$(".vip-limited-time-offer-box .limited-num").text(parseInt(e.data.price/100)),r(e.data.expireDate);var o=setInterval(function(){r(e.data.expireDate),times<0&&clearInterval(o)},1e3)}},error:function(e){}})}),$(document).on("click",".limited-img",function(){u()}),$(document).on("click",".directory-boxshadow-dialog-box",function(){u()}),$(document).on("click",".column-studyvip-pass",function(){getCookie("UserName")?p("control"):window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-ajax",m),$(document).on("click","#columnCouponBox",function(e){if(getCookie("UserName")){if("column_coupon_r"==e.target.className&&!$(this).find(".column_coupon_main").hasClass("active")){var o=e.target.dataset.couponid,t=e.target.dataset.columnid;x(E.columnCouponLook,o,t)}}else window.csdn.loginBox.show()});var Q="",V=!0,M=!1,q="",J=new QRCode(document.getElementById("shareCode"),{width:65,height:65,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});if($("#tool-share").on({mouseover:function(){q=$(this).data("type"),V?(w(),V=!1):M&&$("#tool-QRcode").show()},mouseout:function(){$("#tool-QRcode").hide()}}),sharData){var W=[],Y=0,A="",K=JSON.parse(sharData),X="";if(K.map){for(var Z in K.map)A+='<p class="'+Z+'" data-type="'+Z+'"><span>'+K.map[Z]+"</span></p>";$(".share-code-type").html(A)}$(".share-code-type p").on("click",function(){var e=0,o=K[$(this).data("type")].length;$(".share-bg-box").attr("class","share-bg-box "+$(this).data("type")),X!==$(this).data("type")&&(Y=0),0===Y&&(X=$(this).data("type"),W=_(o)),Y<o?e=W[Y]:(W=_(o),Y=0,e=W[Y]),Y++;var t=K[$(this).data("type")][e];url=t.url,w($(this).data("type"),t.id),isCurrentUserVip||"vip"!=X?$("#shareBgIcon").html(""):(url=t.vipUrl,$("#shareBgIcon").html('<a href="https://mall.csdn.net/vip?utm_source=1074813605" data-report-view={"spm":"1001.2101.3001.9010"} data-report-click={"spm":"1001.2101.3001.9010"} target="_blank" style="display: block;width: 100%;height: 100%;"></a>')),$("#shareBgIcon")[0].style="background: #f3f3f3 url("+url+") no-repeat center;background-size: cover;"})}$("#copyPosterUrl").on("click",function(){Q&&(C(Q),showToast({text:"文章链接已复制",bottom:"10%",zindex:9002,speed:500,time:1500}))})});